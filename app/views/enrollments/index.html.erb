<h1>Matrículas</h1>

<%= search_form_for @search do |f| %>
  <%= f.label "Matrícula:" %>
  <%= f.text_field :student_registration_code_code_cont %>
  <%= f.label "Modalidade:" %>
  <%= f.text_field :modality_name_cont %>
  <%= f.label "Alunos Ativos:" %>
 
  <%=  f.select :active_eq, options_for_select([false, true]), 
  include_blank: true %>
  <%= f.submit %>
<% end %>


<br />
<%= link_to 'Fazer matrícula', new_enrollment_path %>
<table width="100%">
	<thead>
		<tr>
		  <th style="text-align: right"> Nome </th>
			<th style="text-align: right">Matrícula</th>
			<th style="text-align: center">Data de Início</th>
			<th style="text-align: center">Dia do Vencimento</th>
			<th>Descrição</th>
			<th style="text-align: right">Valor</th>
			<th style="text-align: right">Taxa de Inscrição</th>
			<th style="text-align: right">Desconto</th>
			<th style="text-align: center">Modalidade</th>
			<th style="text-align: center">Periodicidade</th>
      <th style="text-align: center">Ativo</th>
			<th></th>
			<th style="text-align: left">Situação</th>
		</tr>
	</thead>
	<tbody>
		<% if !@enrollments.empty? %>
			<% @enrollments.each do |enrollment| %>
				<tr>
				  <td style="text-align: right"><%= enrollment.student.name %></td>
					<td style="text-align: right"><%= enrollment.student.registration_code.code %></td>
					<td style="text-align: center"><%= enrollment.start_date %></td>
					<td style="text-align: right"><%= enrollment.student.registration_code.code %></td>
					<td style="text-align: center"><%= enrollment.start_date.blank? ? "-" : l(enrollment.start_date, :format => :sample) %></td>
					<td style="text-align: center"><%= enrollment.expiration_day %></td>
					<td><%= enrollment.note %></td>
					<td style="text-align: right"><%= enrollment.value %></td>
					<td style="text-align: right"><%= enrollment.registration_fee.blank? ? "-" : enrollment.registration_fee %></td>
					<td style="text-align: right"><%= enrollment.discount.blank? ? "-" : enrollment.discount %></td>
					<td style="text-align: center"><%= enrollment.modality.name %></td>
					<td style="text-align: center"><%= enrollment.periodicity.description if !enrollment.periodicity.nil? %></td>
					<td> <%= enrollment.active %> </td>
					<td>
					  <%= enrollment.expired? ? "Inadiplente" : "Ok" %>
					</td>	
				</tr>
			<% end %>
		<% else %>
			<tr>Não há vencimentos até esta data.</tr>
		<% end %>		
	</tbody>
</table>

<h1>Vencimentos</h1>

<% if !@enrollments.empty? %>
      <% @enrollments.each do |enrollment| %>
        <tr>
          <td>
            <% if !enrollment.expired_payment.empty? %>
              <table>
                <thead>
                  <tr>
                    <th style="text-align: center">Data de vencimento</th>
                    <th>Nome do Aluno</th>
                  </tr>
                </thead>
                <tbody>
                  <% enrollment.expired_payment.each do |payment| %>
                  <tr>
                    <td style="text-align: center"><%= payment.expiration_date %></td>
                    <td><%= payment.individual.name %></td>
                  </tr>
                  <% end %>  
                </tbody>
              </table>
            <% end %>
          </td> 
        </tr>
      <% end %>
    <% else %>
      <tr>Não há vencimentos até esta data.</tr>
    <% end %>
