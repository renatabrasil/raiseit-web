<script type="text/javascript">
    $(function() {
    $('#select_student').autocomplete({
            minLength: 3,
            source: '<%= students_path(:json) %>',
            focus: function(event, ui) {
                $('#select_student').val(ui.item.name);
                return false;
            },
            select: function(event, ui) {
                $('#select_student').val(ui.item.name);
        $('#training_student_id').val(ui.item.id);
                return false;
            }
        })
        .data( "uiAutocomplete" )._renderItem = function( ul, item ) {
            return $( "<li></li>" )
                .data( "item.autocomplete", item )
                .append( "<a>" + item.name + "</a>" )
                .appendTo( ul );
        };
    });
</script>

<br>

<fieldset>
  <% if @training.errors.any? %>
    <div class="alert alert-error">
      <button type="button" class="close" data-dismiss="alert">×</button>
        <ul>
          <% @training.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
    </div>
  <% end %>
  
  <%= nested_form_for([@training], :html => { :class => :form }) do |f| -%>
  
    <br>
    <%= f.label 'Estudante', :class => "control-label" %>
    <%= f.text_field :student_id, :value => (@training.student.blank? ? "" : @training.student.name ), :id => "select_student", :class => "input-xlarge", :onkeyup => "toUppercase(this);", :maxlength => "40" %>
    <%= hidden_field(:training, :student_id) %>
    
    <br>
    <%= f.label 'Professor', :class => "control-label" %>
    <%= select("training", "instructor_id", (@instructors.nil? ? Instructor.all : @instructors).collect {|p| [ p.name, p.id ] }, {include_blank: '-- Selecione o instrutor --'}, {class: "span4", onchange: "atualizaForm()", id:"idModality"}) %>
    
    <br>
    <%= f.label 'Objetivo', :class => "control-label" %>
    <%= select("training", "training_goal_id", TrainingGoal.all.collect {|t| [ t.denomination, t.id ] }, {include_blank: '-- Selecione o objetivo --'}, {class: "span4", onchange: "atualizaForm()", id:"idModality"}) %>
    
    <br>
    <!-- Por enquanto -->
    <table>
      <tr>
        <td><h2>Modelo de ficha: <%= @training.model_workout_sheet.name %></h2></td>
      </tr>
      <% @training.model_workout_sheet.physical_categories.each_with_index do |physical_category, i| %>
        <%#= render partial: "physical_category", collection: @model_workout_sheet.physical_categories %>
        <%= render physical_category %>
      <% end %>
    </table>
    
    
    
    <br>
    <br>
    <div class="form-actions-white">
      <% if @training.id.nil? %>
      <%= f.submit 'Alterar', :name => 'action_button', :value => "Próximo >>"%>
      <% else %>
      <%= f.submit 'Alterar', :name => 'action_button', :value => "Alterar"%>
      <% end %>
      ou 
      <%= link_to "Cancelar", trainings_path, :confirm => "Deseja cancelar a operação? Todos os dados serão perdidos." %>
    </div>
    
  <% end %>
</fieldset>
